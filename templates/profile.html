{% extends 'home.html' %}
{% block body %}
<style>
     body {
      margin-left: 15px;
      margin-top: 100px;
}
.content {
  margin-left: 49px;        /* default sidebar width */
  /* padding: 20px; */
  height: 400px;
  margin-top: -30px;        /* initial space for .nav2 (nav2 height = 100px) */
  transition: margin-top 0.3s ease,margin-left 0.3s ease; /* smooth shift when nav hides/shows */
}
.nav {
  background-color: #cbc7c7;
  padding: 10px;
  border-bottom: 1px solid #ccc;
  display: flex;
  margin-top: -15px;
  margin-left: -15px;
  gap: 15px;
}
    .container {
      /* max-width: 1060px; */
      width: 100%;

      background-color: rgb(250, 249, 249);
      /* box-shadow: 10px 10px 80px rgba(14, 13, 13, 0.1); */
      box-shadow: 5px 7px 20px 20px rgba(0, 0, 0, 0.15);
     
      height: 20px;
      margin-left: -14px;
      padding: 20px;
      /* border-radius: 16px; */
      font-family: Arial, sans-serif;
      margin-top: -10px;
    }


   

.floating-label-container {
  position: relative;
  margin: 20px 0;
  width: 20%;
  /* max-width: 250px; */
}

.floating-label-container input,
.floating-label-container textarea {
  width: 100%;
  padding: 9px;
  border-radius: 6px;
  border: 2px solid #00aaff;
  outline: none;
  font-size: 16px;
  background: white;
}

.floating-label-container label {
  position: absolute;
  top: 50%;
  left: 12px;
  transform: translateY(-50%);
  color: gray;
  background:rgb(250, 249, 249);
  padding: 0 5px;
  font-size: 13px;
  pointer-events: none;
  transition: 0.3s;
}

.floating-label-container input:focus + label,
.floating-label-container input:not(:placeholder-shown) + label,
.floating-label-container textarea:focus + label,
.floating-label-container textarea:not(:placeholder-shown) + label {
  top: -1px;
  font-size: 12px;
  color: #0077cc;
}

 .btn {padding:8px 12px; border:none; border-radius:6px; cursor:pointer;}
    table{width:100%; border-collapse:collapse; margin-left: -14px; background:white;}
    thead th{background:#2f9ed8; color:white; padding:10px; text-align:left; border-radius:4px;}
    td, th{border:1px solid #d6dfe6; padding:10px;}
    .see-btn{background:#4e9fe8; color:white; border-radius:6px; padding:6px 10px;}
    .status-active{color:green; font-weight:600;}
    .status-inactive{color:red; font-weight:700;}
    .form-row{margin-bottom:8px;}
    input, select {padding:8px; border:1px solid #bfcbd6; border-radius:6px;}


</style>
<div style="width: 100%; border: 1px solid rgb(142, 133, 240);" class="content">
  <nav class="nav">
    <button style="font-weight: 600; border: none; padding: 1px; border-radius: 7px; width: 200px;  background-color: rgb(137, 137, 252); color: white;"><a style="color: aliceblue; text-decoration: none;" href=""><i class="fa-solid fa-plus"></i>
 NEW CREATE USER</a></button>

  <!-- Filter buttons -->
 <select id="filterUserType" 
        style="padding:7px 10px; font-weight:600; margin-left:30px; border-radius:8px; border: none; border:1px solid #ccc; cursor:pointer;">
       <option  value="ALL">ALL USERS</option>
       <option value="RADS">RADS</option>
       <option value="IMAGING">IMAGING</option>
</select>
 <!-- yahi tumhare nav ke andar rakho -->
<button id="filterActive" 
  style="padding: 6px; cursor: pointer; font-weight: 500; margin-left: 30px; border-radius: 8px; border: none;">
  <span style="color: rgb(36, 129, 22); font-weight: 600;">ACTIVE </span>
</button>

<button id="filterInactive" 
  style="padding: 9px; font-weight: 500; cursor: pointer; margin-left: 5px; border-radius: 8px; border: none;">
  <span style="color: rgb(234, 19, 19); font-weight: 600;">IN-ACTIVE</span>
</button>


 
  <!-- Search bar -->
<div style=" display: inline-block; margin-left: 50px;">
  <input type="search" id="searchInput" placeholder="Search details..."
    style="margin-left: 0px; padding: 5px 35px 5px 10px; border-radius: 10px; border: none; width: 200px; font-size: 16px;">
  <i class="fa-solid fa-" 
     style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: gray; cursor: pointer;"></i>
</div>

<a style="margin-left: 270px; font-size: 20px; background-color: aliceblue; padding: 7px; border-radius: 8px;" href=""><i class="fa-solid fa-rotate-right"></i> </a>
   
    
  </nav><br>
   <form id="patientForm">
  <div class="container">
    <div style="margin-top: -30px;">

      <div class="floating-label-container">
        <input style="width: 100px;" type="text" id="patientId" placeholder=" " required>
        <label>NAME</label>
      </div>

      <div style="margin-left: 140px; margin-top: -62px; width: 110px;" class="floating-label-container">
        <input type="text" id="patientName" placeholder=" " required>
        <label>USER ID *</label>
      </div>

      <div class="floating-label-container" style="width: 100px; margin-left: 290px; margin-top: -60px;">
        <input type="password" id="password" placeholder=" " required>
        <label>PASSWORD</label>
      </div>

      <div class="floating-label-container" style="width: 100px; margin-left: 430px; margin-top: -60px; position: relative;">
        <select id="scanType" required 
                style="width: 120%; padding: 10px; border-radius: 6px; border: 2px solid #00aaff; background: white;">
          <option value="" disabled selected>USER</option>
          <option value="IMAGING">IMAGING</option>
          <option value="RADS">RADS</option>
          <!-- <option value="EXECUTIVE">EXECUTIVE</option> -->
        </select>
        <label for="scanType"
               style="position: absolute; top: -1px; left: 10px; background: rgb(250, 249, 249); padding: 0 5px; font-size: 12px; color: #00aaff;">
          USER TYPE
        </label>   
      </div>

      <div class="floating-label-container" style="width: 100px; margin-left: 560px; margin-top: -60px;">
        <input type="text" id="contact" placeholder=" " required>
        <label>CONTACT</label>
      </div>

      <div style="margin-top: -55px;">
        <button type="submit"
          style="margin-left: 700px; font-weight: 699; width: 160px; cursor: pointer; color: white; padding: 10px; border: none; background-color: rgb(81, 139, 240); border-radius: 8px;">
          CREATE ACCOUNT
        </button>
      </div>
    </div>
  </div>
</form>

  


  <!-- Table -->
  <table>
    <thead>
      <tr>
        <th>ACCOUNT DATE</th>
        <th>ACCOUNT NAME</th>
        <th>USER ID</th>
        <th>USER TYPE</th>
        <th>STATUS</th>
        <th>ACTION</th>
      </tr>
    </thead>
    <tbody id="userTable">
      <!-- rows will be appended here -->
    </tbody>
  </table>
</div>


<script>

  // ✅ Search by User ID
document.getElementById("searchInput").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault(); // form submit hone se roke
    let query = this.value.trim().toLowerCase();
    let accounts = JSON.parse(localStorage.getItem("accounts")) || [];

    document.getElementById("userTable").innerHTML = "";

    accounts.forEach((acc, i) => {
      if (acc.userId.toLowerCase().includes(query)) {  // sirf userId me search
        addRowToTable(acc, i);
      }
    });
  }
});


  
  // Filter function
function renderFilteredAccounts(filterStatus = "ALL", filterType = "ALL") {
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
  document.getElementById("userTable").innerHTML = "";

  accounts.forEach((acc, i) => {
    let statusMatch = (filterStatus === "ALL" || acc.status === filterStatus);
    let typeMatch   = (filterType === "ALL" || acc.type === filterType);

    if (statusMatch && typeMatch) {
      addRowToTable(acc, i);
    }
  });
}


// Event listeners for buttons
document.getElementById("filterActive").addEventListener("click", function() {
  renderFilteredAccounts("ACTIVE");
});

document.getElementById("filterInactive").addEventListener("click", function() {
  renderFilteredAccounts("INACTIVE");
});

// Dropdown filter by user type
document.getElementById("filterUserType").addEventListener("change", function() {
  let selectedType = this.value;
  renderFilteredAccounts("ALL", selectedType);
});




// Page load hone par sabhi show karna
window.onload = function() {
  renderFilteredAccounts("ALL", "ALL");
};

document.getElementById("patientForm").addEventListener("submit", function(e){
  e.preventDefault();

  let fullName = document.getElementById("patientId").value;
  let userId   = document.getElementById("patientName").value;
  let password = document.getElementById("password").value;
  let userType = document.getElementById("scanType").value;
  let contact  = document.getElementById("contact").value;

  let today = new Date();
  let formattedDate = today.toLocaleDateString('en-GB', { 
    day: '2-digit', month: 'short', year: 'numeric' 
  }).replace(/ /g, '-').toUpperCase();

  let newAccount = {
    date: formattedDate,
    name: fullName,
    userId: userId,
    type: userType,
    password: password,
    status: "ACTIVE",
  };

  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
  accounts.push(newAccount);
  localStorage.setItem("accounts", JSON.stringify(accounts));

  // ✅ yaha row add karte waqt index bhi pass karna hai
  addRowToTable(newAccount, accounts.length - 1);

  document.getElementById("patientForm").reset();
});


// ✅ Row add karne ka function
function addRowToTable(account, rowIndex) {
  let table = document.getElementById("userTable");
  let newRow = table.insertRow();

  newRow.innerHTML = `
    <td>${account.date}</td>
    <td>${account.name}</td>
    <td>${account.userId}</td>
    <td><b>${account.type}</b></td>
   
     <td>
      <span style="
        display:inline-block;
        width:10px;
        height:10px;
        border-radius:50%;
        background-color:${account.status === "ACTIVE" ? "green" : "red"};
        margin-right:6px;
      "></span>
      
    </td>
    <td>
      <button onclick="editAccount(${rowIndex})" 
              style="background:#0074d9; color:white; padding:5px 10px; border:none; border-radius:5px;">
        View
      </button>
       <button onclick="deleteAccount(${rowIndex})" 
              style="background:transparent; border:none; cursor:pointer; font-size:18px; color:red;">
        <i class="fa-solid fa-trash"></i>
      </button>
    </td>
  `;
}

function deleteAccount(index) {
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];

  // confirm popup
  if(confirm("Are you sure you want to delete this account?")) {
    accounts.splice(index, 1);  // array se hatao
    localStorage.setItem("accounts", JSON.stringify(accounts));

    // Table ko refresh kar do
    document.getElementById("userTable").innerHTML = "";
    accounts.forEach((acc, i) => addRowToTable(acc, i));
  }
}



// ✅ Page reload hone par dobara table ban jaaye
window.onload = function() {
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
  accounts.forEach((acc, i) => addRowToTable(acc, i));
};


// ✅ yahi function neeche add karna hai
function editAccount(index) {
  localStorage.setItem("selectedUserIndex", index);
  window.location.href = "{% url 'user_detail' %}";  
  // agar aap direct file use karte ho to:
  // window.location.href = "user_detail.html";
}
</script>
{% endblock %}
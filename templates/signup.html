{% extends 'index.html' %}
{% block body %}

<style>
/* Floating labels & general styles */
.floating-label-container { position: relative; margin: 10px 0; width: 100px; display:inline-block; }
.floating-label-container input, .floating-label-container select {
    width:100%; padding:8px; border:2px solid #00aaff; border-radius:6px; outline:none; background:white;
}
.floating-label-container label {
    position:absolute; top:50%; left:10px; transform:translateY(-50%); color:gray; background:rgb(250,249,249); padding:0 5px; font-size:13px; pointer-events:none; transition:0.3s;
}
.floating-label-container input:focus + label, .floating-label-container input:not(:placeholder-shown) + label,
.floating-label-container select:focus + label, .floating-label-container select:not([value=""]) + label {
    top:-1px; font-size:12px; color:#0077cc;
}

/* Table default styles */
table { width:100%; border-collapse: collapse; margin-top: 20px; background:white; }
thead th { background:#2f9ed8; color:white; padding:10px; text-align:left; }
td, th { border:1px solid #d6dfe6; padding:10px; }
.status-dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; }

/* üåç Responsive design (Tablet) */
@media (max-width: 1024px) {
    .container { margin: 10px; padding: 10px; overflow-x: auto; }
    form { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: flex-start; margin-top: 60px; background-color: #9c9e9f; padding: 10px; border-radius: 8px; }
    .floating-label-container { width: 45%; margin: 5px 0; }
    button.btn { width: 100%; margin: 10px 0; }
    table { font-size: 14px; width: 100%; overflow-x: auto; display: block; }
    th, td { padding: 8px; }
}

/* üì± Mobile view (Below 600px) */
@media (max-width: 600px) {
    .container { width: 100%; padding: 5px; margin: 0; }

    /* Form fields stack vertically */
    form { flex-direction: column; align-items: stretch; margin-left: 0 !important; background-color: #9c9e9f; border-radius: 10px; padding: 10px; }
    .floating-label-container { width: 100%; margin: 6px 0; }
    #filterUserType, #filterActive, #filterInactive { margin: 5px 0; width: 100%; }
    #searchInput { width: 100%; margin: 10px 0; font-size: 15px; }

    /* Table responsive */
    table { width: 100%; font-size: 12px; display: block; overflow-x: auto; }
    thead { display: none; }
    tbody tr { display: block; background: #fff; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 0 4px rgba(0, 0, 0, 0.1); padding: 10px; }
    tbody td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 10px;
        border: none;
        border-bottom: 1px solid #e0e0e0;
    }

    /* Labels for cells except action */
    tbody td:not(:last-child)::before { content: attr(data-label); font-weight: 600; color: #0074d9; margin-right: 10px; }

    /* Action cell flex adjustment */
    tbody td:last-child { justify-content: flex-start; }

    /* Ensure View button visible */
    .see-btn { display: inline-block; padding: 5px 10px; font-size: 12px; margin-top: 0; }
}

/* üß† Small visual polish */
@media (max-width: 400px) {
    table { font-size: 11px; }
    .floating-label-container label { font-size: 12px; }
}
/* Scroll only entries (tbody) ‚Äî header & rest stay fixed */
.table-container {
    max-height: 400px; /* Adjust scroll height as needed */
    overflow-y: auto;  /* Vertical scroll for entries */
    overflow-x: hidden;
    margin-top: 0px;
    margin-left: 0px;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: white;
}

/* Keep table header fixed while scrolling */
.table-container table {
    border-collapse: collapse;
    width: 100%;
}
.table-container thead th {
    position: sticky;
    top: 0;
    background: #2f9ed8;
    color: white;
    z-index: 2;
}

</style>

<div class="container">

    <form style="margin-left: 62px; margin-top: 66px; background-color: #9c9e9f;"
      method="post"
      action="{% url 'create_user_page' %}">

        <!-- Search box -->
        <div style="display:inline-block; margin-left:10px;">
            <input type="search" id="searchInput" placeholder="Search details..." style="margin-left:0; padding:5px 35px 5px 10px; border-radius:10px; border:none; width:200px; font-size:16px;">
        </div>

        <!-- Filters -->
        <select id="filterUserType" style="padding:7px; font-weight:600; margin-left:20px; border-radius:8px; border:1px solid #ccc; cursor:pointer;">
            <option value="ALL">ALL USERS</option>
            <option value="RADS">RADS</option>
            <option value="IMAGING">IMAGING</option>
        </select>

        <button type="button" id="filterActive" style="padding:6px; cursor:pointer; font-weight:500; margin-left:30px; border-radius:8px; border:none;">
            <span style="color: rgb(36, 129, 22); font-weight:600;">ACTIVE</span>
        </button>

        <button type="button" id="filterInactive" style="padding:6px; font-weight:500; cursor:pointer; margin-left:5px; border-radius:8px; border:none;">
            <span style="color: rgb(234, 19, 19); font-weight:600;">IN-ACTIVE</span>
        </button>

        <br><br>
        {% csrf_token %}
        <div class="floating-label-container">{{ form.name }}<label>NAME</label></div>
        <div style="margin-left:20px;" class="floating-label-container">{{ form.userid }}<label>USER ID</label></div>
        <div style="margin-left:20px;" class="floating-label-container">{{ form.password }}<label>PASSWORD</label></div>
        <div style="margin-left:20px;" class="floating-label-container">{{ form.usertype }}<label>USER TYPE</label></div>
        {% if request.session.user_type == 'SUPERADMIN' %}
  <label style="margin-left:20px; font-weight:600; margin-top:10px;">Select Parent Admin (optional)</label>
  <select name="parent_admin_id" class="form-control"
          style="margin-left:20px; width:200px; padding:8px; 
                 border:2px solid #00aaff; border-radius:6px;">
    <option value="">-- None --</option>
    {% for a in admins %}
      <option value="{{ a.id }}">{{ a.name }} ({{ a.userid }})</option>
    {% endfor %}
  </select>
{% endif %}

       
        <button style="background-color:rgb(81, 139, 240); font-weight:700; color:white; border:none; padding:8px; margin-left:-100px; border-radius:5px;" type="submit" class="btn">CREATE ACCOUNT</button>
    </form>

    <!-- Users Table -->
     <div class="table-container">
    <table id="userTable" style="margin-left:62px;">
        <thead>
            <tr>
                <th>ACCOUNT DATE</th>
                <th>ACCOUNT NAME</th>
                <th>USER ID</th>
                <th>USER TYPE</th>
                <th>STATUS</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td data-label="ACCOUNT DATE">{{ user.created_at|date:"d-m-Y" }}</td>
                <td data-label="ACCOUNT NAME">{{ user.name }}</td>
                <td data-label="USER ID">{{ user.userid }}</td>
                <td data-label="USER TYPE" class="usertype">{{ user.usertype }}</td>
                <td data-label="STATUS" class="status-cell" data-status="{{ user.is_active|yesno:'ACTIVE,INACTIVE' }}">
                    {% if user.is_active %}
                        <span class="status-dot" style="background-color:green;"></span>
                    {% else %}
                        <span class="status-dot" style="background-color:red;"></span>
                    {% endif %}
                </td>
                <td data-label="ACTION">
                    <a href="{% url 'user_detail' user.id %}" class="see-btn" style="background:#0074d9; color:white; text-decoration:none; border-radius:6px; padding: 4px;">View</a>
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>

<script>
// Filters & Search functionality
const rows = document.querySelectorAll('#userTable tbody tr');

// Status filter
const btnActive = document.getElementById('filterActive');
const btnInactive = document.getElementById('filterInactive');
let statusFilter = 'ALL';

btnActive.addEventListener('click', () => { statusFilter='ACTIVE'; filterStatus(); });
btnInactive.addEventListener('click', () => { statusFilter='INACTIVE'; filterStatus(); });

function filterStatus(){
    rows.forEach(row => {
        const status = row.querySelector('.status-cell')?.dataset.status.trim().toUpperCase() || '';
        row.style.display = (statusFilter==='ALL' || status===statusFilter)?'':'none';
    });
}

// User type filter
const filterSelect = document.getElementById('filterUserType');
filterSelect.addEventListener('change', () => {
    const selectedType = filterSelect.value.trim().toUpperCase();
    rows.forEach(row => {
        const typeText = row.querySelector('.usertype')?.textContent.trim().toUpperCase() || '';
        row.style.display = (selectedType==='ALL' || typeText===selectedType)?'':'none';
    });
});

// Search filter
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('keyup', () => {
    const filterText = searchInput.value.trim().toUpperCase();
    rows.forEach(row => {
        const name = row.cells[1]?.textContent.trim().toUpperCase() || '';
        const userid = row.cells[2]?.textContent.trim().toUpperCase() || '';
        row.style.display = (filterText==='' || name.includes(filterText) || userid.includes(filterText))?'':'none';
    });
});

// Initialize filters
document.addEventListener('DOMContentLoaded', () => { statusFilter='ALL'; filterSelect.value='ALL'; });
</script>

{% endblock %}
